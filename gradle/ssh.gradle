remotes {
    app1 {
        host = '192.168.0.109'
        port = 122
        user = 'pgadmin'
        password = '1qaz2wsx'
    }
    app3 {
        host = '192.168.0.109'
        port = 422
        user = 'pgadmin'
        password = '1qaz2wsx'
    }
}

task deployApp1 {
    // DeployApp1 configuration start
    println 'deployApp1'
    delegate.ext.setProperty('activeProfile', 'uat-gw')
    dependsOn ('clean', 'war')
    // DeployApp1 configuration end
    // DeployApp1 execution
    doLast {
        ssh.run {
            session(remotes.app1) {
                settings {
                    pty = true
                }
                execute 'echo 1qaz2wsx | sudo -S systemctl stop wildfly'
                put from: file('./ha-mysql-cluster/server1/wildfly/standalone-full-ha.xml'),
                        into: '/opt/wildfly-14.0.1.Final/standalone/configuration', fileTransfer: 'scp'
                put from: file('./build/libs/pg.war'),
                        into: '/opt/wildfly-14.0.1.Final/standalone/deployments', fileTransfer: 'scp'
                execute 'echo 1qaz2wsx | sudo -S systemctl start wildfly'
            }
        }
    }
}

task deployApp3 {
    delegate.ext.setProperty('activeProfile', 'uat-app')
    dependsOn ('clean', 'war')
    doLast {
        ssh.run {
            session(remotes.app3) {
                settings {
                    pty = true
                }
                execute 'echo 1qaz2wsx | sudo -S systemctl stop wildfly'
                put from: file('./ha-mysql-cluster/server3/wildfly/standalone-full-ha.xml'),
                        into: '/opt/wildfly-14.0.1.Final/standalone/configuration', fileTransfer: 'scp'
                put from: file('./build/libs/pg.war'),
                        into: '/opt/wildfly-14.0.1.Final/standalone/deployments', fileTransfer: 'scp'
                execute 'echo 1qaz2wsx | sudo -S systemctl start wildfly'
            }
        }
    }
}
