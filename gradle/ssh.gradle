remotes {
    app1 {
        host = '192.168.0.109'
        port = 122
        user = 'pgadmin'
        password = '1qaz2wsx'
    }
    app2 {
        host = '192.168.0.109'
        port = 222
        user = 'pgadmin'
        password = '1qaz2wsx'
    }
    app3 {
        host = '192.168.0.109'
        port = 422
        user = 'web'
        password = 'web'
    }
}


task stopApp1 {
    doLast {
        println 'run stopApp1'
        ssh.run {
            session(remotes.app1) {
                settings {
                    pty = true
                }
                execute 'echo 1qaz2wsx | sudo -S systemctl stop wildfly'
            }
        }
    }
}

task stopApp2 {
    doLast {
        ssh.run {
            session(remotes.app2) {
                settings {
                    pty = true
                }
                execute 'echo 1qaz2wsx | sudo -S systemctl stop wildfly'
            }
        }
    }
}


task deployApp1 {
    // DeployApp1 configuration start
    println 'config deployApp1'
    delegate.ext.setProperty('activeProfile', 'uat-gw')
    dependsOn ('clean', 'npmBuild', 'war')
    // DeployApp1 configuration end
    // DeployApp1 execution
    doLast {
        ssh.run {
            session(remotes.app1) {
                settings {
                    pty = true
                }
                put from: file('./ha-mysql-cluster/server1/wildfly/standalone-full-ha.xml'),
                        into: '/home/pgadmin/wildfly', fileTransfer: 'scp'
                execute 'echo 1qaz2wsx | sudo -u web -S cp /home/pgadmin/wildfly/standalone-full-ha.xml /opt/wildfly-14.0.1.Final/standalone/configuration'
                put from: file('./build/libs/pg.war'),
                        into: '/home/pgadmin/wildfly', fileTransfer: 'scp'
                execute 'echo 1qaz2wsx | sudo -u web -S cp /home/pgadmin/wildfly/pg.war /opt/wildfly-14.0.1.Final/standalone/deployments'
                execute 'echo 1qaz2wsx | sudo -S systemctl start wildfly'
            }
        }
    }
}

task deployApp2 {
    println 'config deployApp2'
    delegate.ext.setProperty('activeProfile', 'uat-gw')
    dependsOn ('clean', 'npmBuild', 'war')
    doLast {
        ssh.run {
            session(remotes.app2) {
                settings {
                    pty = true
                }
                put from: file('./ha-mysql-cluster/server2/wildfly/standalone-full-ha.xml'),
                        into: '/home/pgadmin/wildfly', fileTransfer: 'scp'
                execute 'echo 1qaz2wsx | sudo -u web -S cp /home/pgadmin/wildfly/standalone-full-ha.xml /opt/wildfly-14.0.1.Final/standalone/configuration'
                put from: file('./build/libs/pg.war'),
                        into: '/home/pgadmin/wildfly', fileTransfer: 'scp'
                execute 'echo 1qaz2wsx | sudo -u web -S cp /home/pgadmin/wildfly/pg.war /opt/wildfly-14.0.1.Final/standalone/deployments'
                execute 'echo 1qaz2wsx | sudo -S systemctl start wildfly'
            }
        }
    }
}

task deployApp3 {
    delegate.ext.setProperty('activeProfile', 'uat-app')
    dependsOn ('clean', 'npmBuild', 'war')
    doLast {
        ssh.run {
            session(remotes.app3) {
                settings {
                    pty = true
                }
                execute 'echo 1qaz2wsx | sudo -S systemctl stop wildfly'
                put from: file('./ha-mysql-cluster/server3/wildfly/standalone-full-ha.xml'),
                        into: '/opt/wildfly-14.0.1.Final/standalone/configuration', fileTransfer: 'scp'
                put from: file('./build/libs/pg.war'),
                        into: '/opt/wildfly-14.0.1.Final/standalone/deployments', fileTransfer: 'scp'
                execute 'echo 1qaz2wsx | sudo -S systemctl start wildfly'
            }
        }
    }
}
